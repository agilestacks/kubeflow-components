---
version: 1
kind: component
meta:
  name: kubeflow-authn
  title: Kubeflow Auth
  brief: Machine learning
  category: AI and Machine Learning
  version: 1.2.0
  licence: Apache 2.0
  source:
    dir: ../../components/kubeflow-authn

requires:
  - kubernetes

parameters:
- name: dns.domain
  env: DOMAIN_NAME
- name: component.dex.issuer
  value: ${component.ingress.protocol}://auth.${dns.domain}
- name: component.ingress.protocol
  value: https
- name: component.istio.namespace
  value: istio-system
  env: NAMESPACE
- name: component.istio.ingressGateway
- name: component.kubeflow
  parameters:
  - name: name
  - name: version
    value: v1.2.0
    env: VERSION
  - name: authn.oidcProvider
    value: ${component.ingress.protocol}://auth.${dns.domain}
  - name: authn.oidcRedirectURI
    value: https://${component.kubeflow.name}.${dns.domain}/login/oidc
  - name: authn.oidcClientId
    value: ${component.kubeflow.name}-client
  - name: authn.oidcSecret
  - name: authn.caSecret
    env: AUTHN_CA_SECRET
    empty: allow
  - name: authn.sessionMaxAge
    value: 86400
  - name: authn.volumeSize
    value: 10Gi


templates:
  files:
  - "*.template"
  - "patches/*.template"
